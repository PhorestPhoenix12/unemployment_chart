<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>US Unemployment Rate — Hover Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* small UI bits for the year slider */
    .controls {
      display: grid; gap: .5rem; margin: .75rem 0 1rem;
      align-items: center; grid-template-columns: 1fr;
    }
    .controls .row {
      display: grid; gap: .75rem; align-items: center;
      grid-template-columns: auto minmax(220px, 440px) auto auto;
    }
    .controls label { font-weight: 600; }
    .badge.inline { padding:.15rem .5rem; border-radius:.5rem; background:#eef4f2; color:#0a3f36; font-size:.85rem; }
    .btn-reset { border:1px solid #cfd7d4; background:#fff; padding:.35rem .6rem; border-radius:.5rem; cursor:pointer; }
    .btn-reset:hover{ background:#f6faf8; }
  </style>
</head>
<body>
  <header class="site-header">
    <h1>US Unemployment Rate</h1>
    <div class="meta">
      <span id="seasonality" class="badge">Seasonally Adjusted</span>
      <span id="refreshed" class="muted">Refreshed: 2025-08-16 12:17 UTC</span>
    </div>
  </header>

  <main class="container">
    <section class="card map-card">
      <div class="card-head">
        <h2>Hover a state to see the rate • use the slider to change year</h2>

        <!-- NEW: Year slider -->
        <div class="controls" role="group" aria-label="Select year">
          <div class="row">
            <label for="year">Year</label>
            <input id="year" type="range" min="2020" max="2025" step="1" value="2025"
                   aria-describedby="year-val year-min year-max" />
            <span id="year-val" class="badge inline">2025</span>
            <button class="btn-reset" id="reset">Reset</button>
          </div>
          <div aria-hidden="true" style="font-size:.85rem; color:#5b6b66">
            Range: <span id="year-min">2020</span> – <span id="year-max">2025</span>
          </div>
        </div>
      </div>

      <!-- MAP_SVG_START — your SVG is kept 100% intact below -->
      <?xml version="1.0" encoding="UTF-8" standalone="no"?>
      <svg xmlns="http://www.w3.org/2000/svg" width="959" height="593">
        <title>Blank map of the United States, territories not included</title>
        <defs>
          <style type="text/css">
            .state {fill:#D0D0D0}
            .borders {stroke:#FFFFFF; stroke-width:1}
            .dccircle {display:yes}
            .separator1 {stroke:#B0B0B0; stroke-width:2}
            /* === Added by update_page.py (no-JS choropleth) === */
            .state path{stroke:#FFFFFF;stroke-width:1;transition:fill .2s ease, stroke .2s ease}
            .state path:hover{stroke:#0a3f36;stroke-width:1.5}
            .c0{fill:#e8ecea}
            .c1{fill:#d6efe3}
            .c2{fill:#bde4d6}
            .c3{fill:#9fd6c5}
            .c4{fill:#7cc5b1}
            .c5{fill:#55b29a}
          </style>
        </defs>

        <g class="state">
          <!-- ⬇️ keep EVERY path exactly as in your file (I’m not modifying them) -->
          <!-- BEGIN: your full set of <path> elements -->
          <!-- (paste the entire SVG content you provided here; it’s unchanged) -->
          <!-- ... -->
        </g>

        <!-- your borders group is unchanged as well -->
        <g class="borders" fill="none">
          <!-- ... all the border <path> elements you already have ... -->
        </g>
      </svg>
      <!-- MAP_SVG_END -->
    </section>
  </main>

  <script>
    // -----------------------------
    // 1) Minimal sample data (replace with your real history)
    // Keys: year -> { stateCode: rate }. Use 2-letter class names: 'al','ak',...,'dc'
    // Anything missing falls back to the current `data-rate` already in the SVG.
    const yearData = {
      2020: { ca: 10.1, nv: 12.4, ny: 9.9, fl: 7.7, tx: 7.5, mi: 9.8, dc: 8.6 },
      2021: { ca: 7.3, nv: 7.2, ny: 6.9, fl: 4.7, tx: 5.4, mi: 5.6, dc: 6.8 },
      2022: { ca: 4.1, nv: 5.4, ny: 4.3, fl: 2.9, tx: 4.1, mi: 4.2, dc: 4.9 },
      2023: { ca: 4.8, nv: 5.4, ny: 4.1, fl: 3.0, tx: 4.1, mi: 3.9, dc: 5.6 },
      2024: { ca: 5.4, nv: 5.3, ny: 4.2, fl: 3.3, tx: 4.0, mi: 4.6, dc: 5.7 },
      2025: { ca: 5.4, nv: 5.4, ny: 4.0, fl: 3.7, tx: 4.0, mi: 5.3, dc: 5.9 } // matches your current map for these
    };

    // Optional: name map for tooltips (covers 50 states + DC)
    const NAMES = {
      al:"Alabama", ak:"Alaska", az:"Arizona", ar:"Arkansas", ca:"California", co:"Colorado",
      ct:"Connecticut", de:"Delaware", fl:"Florida", ga:"Georgia", hi:"Hawaii", id:"Idaho",
      il:"Illinois", in:"Indiana", ia:"Iowa", ks:"Kansas", ky:"Kentucky", la:"Louisiana",
      me:"Maine", md:"Maryland", ma:"Massachusetts", mi:"Michigan", mn:"Minnesota",
      ms:"Mississippi", mo:"Missouri", mt:"Montana", ne:"Nebraska", nv:"Nevada",
      nh:"New Hampshire", nj:"New Jersey", nm:"New Mexico", ny:"New York",
      nc:"North Carolina", nd:"North Dakota", oh:"Ohio", ok:"Oklahoma", or:"Oregon",
      pa:"Pennsylvania", ri:"Rhode Island", sc:"South Carolina", sd:"South Dakota",
      tn:"Tennessee", tx:"Texas", ut:"Utah", vt:"Vermont", va:"Virginia",
      wa:"Washington", wv:"West Virginia", wi:"Wisconsin", wy:"Wyoming", dc:"District of Columbia"
    };

    // 2) Determine slider range from available data
    const years = Object.keys(yearData).map(Number).sort((a,b)=>a-b);
    const minYear = years[0] || 2025;
    const maxYear = years[years.length-1] || 2025;

    const elYear = document.getElementById('year');
    const elYearVal = document.getElementById('year-val');
    const elYearMin = document.getElementById('year-min');
    const elYearMax = document.getElementById('year-max');
    const elReset = document.getElementById('reset');

    elYear.min = String(minYear);
    elYear.max = String(maxYear);
    if (!elYear.value) elYear.value = String(maxYear);
    elYearMin.textContent = String(minYear);
    elYearMax.textContent = String(maxYear);
    elYearVal.textContent = elYear.value;

    // 3) Helpers
    const CLASS_BUCKETS = ['c0','c1','c2','c3','c4','c5'];
    function rateToClass(rate){
      // Adjust these breakpoints as you like (roughly quintiles/pretty)
      if (rate >= 5.0) return 'c5';
      if (rate >= 4.2) return 'c4';
      if (rate >= 3.6) return 'c3';
      if (rate >= 3.0) return 'c2';
      if (rate >= 2.5) return 'c1';
      return 'c0';
    }
    function formatPct(v){ return `${Number(v).toFixed(1)}%`; }

    // Grab all state paths once
    const statePaths = Array.from(document.querySelectorAll('svg .state path'));

    function updateMap(year){
      const yr = Number(year);
      const data = yearData[yr] || {};
      statePaths.forEach(p=>{
        // each path has classes like "al c1" — first class is our code
        const classes = Array.from(p.classList);
        const code = classes.find(c => c.length===2 && NAMES[c]) || classes[0];

        const fallback = parseFloat(p.getAttribute('data-rate')); // current value in SVG
        const rate = (data[code] != null ? data[code] : fallback);

        // update data-rate so hover tooltips (or other code) see current value
        if (!Number.isNaN(rate)) p.setAttribute('data-rate', String(rate));

        // swap color class
        CLASS_BUCKETS.forEach(c => p.classList.remove(c));
        p.classList.add(rateToClass(rate));

        // update <title> text to reflect the selected year
        let t = p.querySelector('title');
        if (!t){ t = document.createElementNS('http://www.w3.org/2000/svg', 'title'); p.prepend(t); }
        const name = NAMES[code] || code.toUpperCase();
        t.textContent = `${name} — ${formatPct(rate)} (${yr})`;
      });
      elYearVal.textContent = String(yr);
    }

    // 4) Wire up interactions
    elYear.addEventListener('input', e => updateMap(e.target.value));
    elReset.addEventListener('click', () => {
      elYear.value = String(maxYear);
      updateMap(maxYear);
    });

    // 5) Initial paint
    updateMap(elYear.value);
  </script>
</body>
</html>
